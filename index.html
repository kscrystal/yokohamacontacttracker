<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Contact Manager</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial; background:#f4f6f9; padding:20px; }
.container { max-width:700px; margin:auto; background:white; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
form { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:15px;}
input, select, textarea { padding:8px; border-radius:8px; border:1px solid #ccc; }
button { grid-column:span 2; padding:12px; border:none; border-radius:8px; background:#3b82f6; color:white; font-weight:bold;}
.preview { max-width:100%; margin-top:10px; border-radius:8px;}
.success{color:green;}
.error{color:red;}
.full{grid-column:span 2;}
</style>
</head>

<body>
<div class="container">
<h2>Add Contact</h2>

<form id="form">

<div class="full">
<label>Photo Upload</label>
<input type="file" id="photoInput" accept="image/*">
<img id="preview" class="preview"/>
</div>

<input name="Name" placeholder="Name" required>

<select name="GospelShared">
<option value="">Gospel Shared?</option>
<option>Yes</option>
<option>No</option>
</select>

<select name="Salvation">
<option value="">Salvation?</option>
<option>Yes</option>
<option>No</option>
</select>

<select name="Prayed">
<option value="">Prayed?</option>
<option>Yes</option>
<option>No</option>
</select>

<select name="FollowUpBy">
<option value="">Follow Up By</option>
<option>A</option><option>B</option><option>C</option><option>D</option><option>E</option>
</select>

<input name="LINEID" placeholder="LINE ID">
<input name="InstagramID" placeholder="Instagram ID">
<input name="HelloTalkID" placeholder="HelloTalk ID">

<select name="JobSchool">
<option value="">Job / School</option>
<option>Job</option>
<option>School</option>
</select>

<input name="OccupationCourse" placeholder="Occupation / Course">

<select name="MilestoneScore">
<option value="">Milestone</option>
<option value="0">Not Open</option>
<option value="0.5">Open</option>
<option value="1">Salvation</option>
<option value="1.5">Next Step Started</option>
<option value="2">Next Step Completed</option>
<option value="2.5">Next Step Weekend 1</option>
<option value="3">Baptism of Holy Spirit</option>
<option value="4">Baptism</option>
</select>

<textarea name="Remarks" placeholder="Remarks"></textarea>

<button type="submit">Save Contact</button>

</form>

<div id="msg"></div>
</div>

<script>
const WEB_APP_URL = "PASTE_YOUR_WEB_APP_URL";
let compressedImage = "";

// ðŸ”¥ COMPRESS IMAGE BEFORE SENDING
document.getElementById("photoInput").addEventListener("change", function(e){
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(event){
    const img = new Image();
    img.src = event.target.result;

    img.onload = function(){
      const canvas = document.createElement("canvas");

      const maxWidth = 600;
      const scale = maxWidth / img.width;

      canvas.width = maxWidth;
      canvas.height = img.height * scale;

      const ctx = canvas.getContext("2d");
      ctx.drawImage(img,0,0,canvas.width,canvas.height);

      compressedImage = canvas.toDataURL("image/jpeg", 0.6); // 60% quality

      document.getElementById("preview").src = compressedImage;
    };
  };
  reader.readAsDataURL(file);
});

document.getElementById("form").addEventListener("submit", function(e){
  e.preventDefault();

  const data = Object.fromEntries(new FormData(this).entries());
  data.PhotoURL = compressedImage;

  fetch(WEB_APP_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(data)
  })
  .then(res=>res.json())
  .then(res=>{
    if(res.success){
      document.getElementById("msg").innerHTML="<p class='success'>Saved!</p>";
      this.reset();
      document.getElementById("preview").src="";
      compressedImage="";
    }else{
      document.getElementById("msg").innerHTML="<p class='error'>"+res.error+"</p>";
    }
  })
  .catch(err=>{
    document.getElementById("msg").innerHTML="<p class='error'>"+err+"</p>";
  });
});
</script>

</body>
</html>
